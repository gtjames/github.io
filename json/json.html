<!DOCTYPE html>
<htmllang="en">
<head>
<title>JSON</title>
</head>
<body>
<section>
       This is a MINIMAL example of JSON<BR>
       <strong>Casablanca</strong> will read a text file and replace the button with the textof the source file<BR>
       <strong>Read a JSON file</strong>will read a JSON file and replace the button with the text of the sourcefile<BR>
       <strong>Read an HTMLfile</strong> will read an HTML file and replace the button with the HTMLof the source file<BR>
       Click and view the source to see howbasic this example is.<BR>
       <divid="serverState"></div>
       <div>
            <input type="button"value="Read Casablanca" onclick="getFileFromServer('/json/Casablanca.json', 'Textdiv', true )"/>
       </div>
       <div id="Textdiv">
       </div>
       <div>
              <input type="button"value="Random Quote" onclick="getQuote()"/>
       </div>
       <div id="quote">       </div>
       <div>
              <input type="button"value="Random Trivia" onclick="getTrivia()"/>
       </div>
       <div id="trivia">
       </div>
</section>
 
<script>
functiongetFileFromServer(url, divId, isJSON)
{
       //     Weneed an object that allows us to make requests back to our server
       var xmlhttp = new XMLHttpRequest();
       
       //     Thisobject has an attribute called onreadystatechange. 
       //     Weare going to set the value of that attribute to a pointer to a function
       //     Thereare a couple of ways to do that. What I am showing here is an ANONYMOUSfunction
       //     Functionsare usually defined as    functionthisIsMyFunction () { 'put code here' }
       //     Inthis case I just say function() without a function name and then provide thecode for a function
       //     Youcould also have a function defined someplace in your code and setonreadystatechange = thisIsMyFunction
       //     bothwork
       xmlhttp.onreadystatechange =
                     function()
                     {      //     This code is notexecuted immedidaitely. It is call later when the server starts to respond.
                           if(xmlhttp.readyState == 4 && xmlhttp.status == 200)
                                  //     This method is going to serve a severalkinds of requests
                                  //     we are taking the 2nd and 3rd fields fromthe onclick request and passing them to the worked function
                                  doSomethingWithTheResponse(xmlhttp.responseText,divId, isJSON);
                     //     else   // this will show uswhat is happening before the data arrives
                     //            document.getElementById( 'serverState' ).innerHTML +="Ready State: " + xmlhttp.readyState + "  Status: " + xmlhttp.status +"<BR>";
                     }
       //     Thisis where we make our request to the server. We are passing along the URL forthe file we want
       //     Youcan see the name of the file we are requesting in the about HTML code.
       //     Eachbutton has a different file defined
       xmlhttp.open("GET", url, true);
       xmlhttp.send();
       
       //     sometime later the above anonymous function will be called and the file will beprocessed
}
 
//     We are going to receive our file and takewhat we received and do something with it on our web page
function doSomethingWithTheResponse(response, divId, isJSON) 
{
       //     document.getElementById('serverState' ).innerHTML += "<BR>";
       //     Lookback at the HTML where the onclick action was defined for each of the differentbuttons 
       //     Thethird field is a boolean. I am using it to flag the returning file as a JSONfile (true) or text (false)
       //     Ifthe data coming back is JSON we need to parse it. Otherwise we are just goingto take it as is
       var responseText = (isJSON) ?JSON.parse(response) : response;
 
       //     Nowwe will take the text and do something with it
       document.getElementById( divId).innerHTML = (isJSON) ? responseText.JSONKey : responseText;
}
</script>
</body>
 
</html>
